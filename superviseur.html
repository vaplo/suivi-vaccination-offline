<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Espace Superviseur</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <h1>üìä Espace Superviseur</h1>

    <section id="stats">
      <p><strong>Nombre d‚Äôenfants enregistr√©s :</strong> <span id="nb-enfants">...</span></p>
      <p><strong>Vaccins administr√©s :</strong> <span id="nb-vaccins">...</span></p>
      <p><strong>Grossesses enregistr√©es :</strong> <span id="nb-grossesses">...</span></p>
      <p><strong>Retards de vaccination :</strong> <span id="nb-retards">...</span></p>
    </section>

    <button id="btn-export">‚¨áÔ∏è Exporter les donn√©es</button>

    <a href="index.html" class="btn btn-outline" style="margin-top: 2rem;">‚¨Ö Retour √† l'accueil</a>
  </div>

  <script>
    async function chargerStats() {
      try {
        const response = await fetch('/webhook/statistiques-globales');
        const data = await response.json();

        document.getElementById('nb-enfants').textContent = data.enfants || '0';
        document.getElementById('nb-vaccins').textContent = data.vaccins || '0';
        document.getElementById('nb-grossesses').textContent = data.grossesses || '0';
        document.getElementById('nb-retards').textContent = data.retards || '0';
      } catch (err) {
        document.getElementById('stats').innerHTML = "<p style='color:red;'>Erreur de connexion. Statistiques indisponibles.</p>";
      }
    }

    function exporterCSV() {
      const lignes = [
        ["Indicateur", "Valeur"],
        ["Enfants enregistr√©s", document.getElementById('nb-enfants').textContent],
        ["Vaccins administr√©s", document.getElementById('nb-vaccins').textContent],
        ["Grossesses enregistr√©es", document.getElementById('nb-grossesses').textContent],
        ["Retards de vaccination", document.getElementById('nb-retards').textContent],
      ];
      const csv = lignes.map(l => l.join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'statistiques_vaccination.csv';
      a.click();
    }

    document.getElementById('btn-export').addEventListener('click', exporterCSV);
    chargerStats();
  </script>
</body>
</html>
