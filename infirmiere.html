<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlowLab – Espace Médical</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#16a085" />
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("✅ SW actif"))
        .catch(err => console.error("❌ SW error:", err));
    }
  </script>
</head>
<body>
  <header class="top-bar">
    <img src="images/logo.png" alt="FlowLab Logo" class="logo" />
    <h1>FlowLab</h1>
    <h2>Espace Médical – Suivi et enregistrement</h2>
  </header>

  <main class="container">
    <div style="margin-top: 1rem;">
      <a href="index.html" class="btn">⬅ Retour</a>
    </div>

    <div id="liste-vaccins">
      <h3>🗓 Vaccins à faire aujourd’hui</h3>
      <table id="vaccins" class="table-vaccins"></table>
    </div>

    <div id="formulaire-enfant" class="formulaire" style="display:none;">
      <h3>👶 Formulaire Enfant</h3>
      <input id="nom_complet" placeholder="Nom complet" />
      <input type="date" id="date_naissance" />
      <select id="sexe">
        <option value="">Sexe</option>
        <option>F</option>
        <option>M</option>
      </select>
      <input id="telephone_parent" placeholder="Téléphone du parent" />
      <input id="centre_sante" placeholder="Structure de santé" />
      <input id="province" placeholder="Province" />
      <select id="langue_preferee">
        <option value="">Langue préférée</option>
        <option value="francais">Français</option>
        <option value="lingala">Lingala</option>
        <option value="swahili">Swahili</option>
        <option value="tshiluba">Tshiluba</option>
        <option value="kikongo">Kikongo</option>
      </select>
      <button onclick="enregistrerEnfant()">📩 Envoyer</button>
      <div id="message-enfant"></div>
    </div>

    <div id="formulaire-grossesse" class="formulaire" style="display:none;">
      <h3>🧐 Formulaire Grossesse</h3>
      <input id="nom_grossesse" placeholder="Nom complet" />
      <input id="telephone_grossesse" placeholder="Téléphone" />
      <input type="number" id="semaines_grossesse" placeholder="Semaines de grossesse" />
      <input type="date" id="dpa" />
      <input id="centre_sante_grossesse" placeholder="Structure de santé" />
      <input id="province_grossesse" placeholder="Province" />
      <select id="langue_preferee_grossesse">
        <option value="">Langue préférée</option>
        <option value="francais">Français</option>
        <option value="lingala">Lingala</option>
        <option value="swahili">Swahili</option>
        <option value="tshiluba">Tshiluba</option>
        <option value="kikongo">Kikongo</option>
      </select>
      <button onclick="enregistrerGrossesse()">📩 Envoyer</button>
      <div id="message-grossesse"></div>
    </div>

    <section class="grid-cards">
      <div class="card" style="background-image: url('images/enfants.png')">
        <h3>👶 Enfants</h3>
        <p>Ajoutez un enfant dans le système avec ses informations.</p>
        <button class="btn" onclick="afficherFormulaire('enfant')">Enregistrer un enfant</button>
      </div>
      <div class="card" style="background-image: url('images/grossesses.png')">
        <h3>🧐 Grossesses</h3>
        <p>Inscrivez une femme enceinte pour le suivi prénatal.</p>
        <button class="btn btn-secondary" onclick="afficherFormulaire('grossesse')">Enregistrer une grossesse</button>
      </div>
      <div class="card" style="background-image: url('images/surveillance-soins.png')">
        <h3>🗓 Vaccins aujourd’hui</h3>
        <p>Consultez la liste des enfants à vacciner aujourd’hui.</p>
        <button class="btn" onclick="chargerVaccins()">Voir vaccins</button>
      </div>
    </section>
  </main>

  <script>
    const webhookEnfant = "https://n8n-automation-server-waz-production.up.railway.app/webhook-test/register-child";
    const webhookGrossesse = "https://n8n-automation-server-waz-production.up.railway.app/webhook-test/register-pregnancy";
    const webhookVaccins = "https://n8n-automation-server-waz-production.up.railway.app/webhook-test/surveillance-soins";
    const webhookVaccinFait = "https://n8n-automation-server-waz-production.up.railway.app/webhook-test/vaccin-fait";

    function afficherFormulaire(type) {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      document.getElementById("formulaire-enfant").style.display = (type === "enfant") ? "block" : "none";
      document.getElementById("formulaire-grossesse").style.display = (type === "grossesse") ? "block" : "none";
      document.getElementById("liste-vaccins").style.display = "none";
    }

    function chargerVaccins() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      document.getElementById("formulaire-enfant").style.display = "none";
      document.getElementById("formulaire-grossesse").style.display = "none";
      fetch(webhookVaccins)
        .then(r => r.json())
        .then(data => {
          const lignes = data.map(v => `
            <tr>
              <td>${v.nom}</td>
              <td>${v.vaccin}</td>
              <td>${v.date_prevue}</td>
              <td><button onclick="marquerVaccinFait('${v.id}')">✅ Fait</button></td>
            </tr>`).join('');
          document.getElementById("vaccins").innerHTML = `
            <tr><th>Nom</th><th>Vaccin</th><th>Date</th><th>Action</th></tr>
            ${lignes}`;
          document.getElementById("liste-vaccins").style.display = "block";
        })
        .catch(() => {
          document.getElementById("vaccins").innerHTML = "<tr><td colspan='4'>❌ Erreur lors du chargement</td></tr>";
          document.getElementById("liste-vaccins").style.display = "block";
        });
    }

    function marquerVaccinFait(id) {
      fetch(webhookVaccinFait, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id })
      }).then(() => chargerVaccins());
    }

    function enregistrerEnfant() {
      const data = {
        nom_complet: document.getElementById("nom_complet").value,
        date_naissance: document.getElementById("date_naissance").value,
        sexe: document.getElementById("sexe").value,
        telephone_parent: document.getElementById("telephone_parent").value,
        centre_sante: document.getElementById("centre_sante").value,
        province: document.getElementById("province").value,
        langue_preferee: document.getElementById("langue_preferee").value
      };
      fetch(webhookEnfant, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }).then(res => {
        document.getElementById("message-enfant").innerHTML = res.ok ? "<p class='success'>✅ Enfant enregistré</p>" : "<p class='error'>❌ Échec</p>";
      }).catch(() => {
        document.getElementById("message-enfant").innerHTML = "<p class='error'>❌ Erreur de réseau</p>";
      });
    }

    function enregistrerGrossesse() {
      const data = {
        nom: document.getElementById("nom_grossesse").value,
        telephone: document.getElementById("telephone_grossesse").value,
        semaines_grossesse: parseInt(document.getElementById("semaines_grossesse").value || "0", 10),
        dpa: document.getElementById("dpa").value,
        centre_sante: document.getElementById("centre_sante_grossesse").value,
        province: document.getElementById("province_grossesse").value,
        langue_preferee: document.getElementById("langue_preferee_grossesse").value
      };
      fetch(webhookGrossesse, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }).then(res => {
        document.getElementById("message-grossesse").innerHTML = res.ok ? "<p class='success'>✅ Grossesse enregistrée</p>" : "<p class='error'>❌ Échec</p>";
      }).catch(() => {
        document.getElementById("message-grossesse").innerHTML = "<p class='error'>❌ Erreur de réseau</p>";
      });
    }
  </script>
</body>
</html>






